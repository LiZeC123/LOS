

计算机的启动过程
---------------

### BIOS启动

计算机启动后会设置段寄存器cs和指令寄存器ip的值, 使其指向0xffff0. 该位置实际映射的是BIOS的只读存储器, 因此进入了BIOS的代码之中. 

BIOS的代码会进行硬件的状态检查, 建立中断向量表等工作.  经过BIOS的上述操作后, 整个系统的内存布局如下表所示

![实模式内存布局](images/实模式内存布局.jpg)


从图中可以看到, 最低的640KB内存就对应了实际的物理内存条, 而后面的内存空间实际上就是各种设备了.

### 加载MBR

BIOS执行完启动代码后, 就会从硬盘加载MBR(Main Boot Record)数据. MBR是一段代码, 其长度为512字节, BIOS将其加载到内存0x7c00的位置, 之后由MRB中的代码负责引导操作系统内核. 

> 从内存布局可以看到, 0x7c00是低32KB的空间中最后1KB的空间, 这样设置能够尽可能避免MBR太早被内核数据覆盖导致错误

由于BIOS仅加载512字节数据, 因此无法在MBR中完成内存的加载操作. 因此MBR代码的主要工作是将内核的加载器加载到内存之中,并有加载器将系统内核加载到内存.

### 内核加载器





MBR的结构
------------

BIOS固定从硬盘的0盘0道1扇区（即硬盘的第一个扇区）加载MBR记录, 因此MBR必须位于该位置. 而且为了避免错误, 该扇区的最后两个字节必须为0x55和0xaa. 

由于BIOS仅加载这一个扇区的512字节数据, 因此MBR中最多能放入510字节的代码. 



页表结构
---------------

页表分为页目录项和页表项, 也目录项实际上就是一个存储页表项的索引数组,


![](images/页目录.png)


其中最高的20位存储了页表项的地址. 由于每个页表项占用4KB大小, 因此在对齐的情况下, 低12位都是零.




![](images/页表项.png)




一个32位的地址被分割为三个部分, 第一部分10bit, 第二部分10bit, 第三部分12bit.

第一部分对应也目录的索引, 第二部分对应也表项的的索引, 第三部分对应偏移地址

首先根据第一部分定位到页目录项, 从该项中找到对应的页表的位置. 然后根据第二部分定位页表项的位置.



快表(TLB)
---------------

由于分页的转换过程需要多次查询内存, 一个地址转换过程需要如下的步骤

1. 根据CR3寄存器获得页表在内存中的位置
2. 根据虚拟地址的高10bit计算页目录项在页目录表中的偏移
3. 根据根据虚拟地址的中间10bit以及页目录项中的值定位页表项下页表中的偏移
4. 拼接页表项中的记录与虚拟地址的最低12bit得到真实物理地址

由于内存的速度显著低于CPU的速度, 因此如果每次内存访问都有增加这么多转换步骤, 那么开启分页模式后, 系统的性能将会显著降低. 为了解决这一问题, CPU中引入了快表.

快表实际上可以认为是一个缓存, 其中记录了虚拟地址的高20bit与真实地址的高20bit的对应关系, 从而可以直接通过一次快表查询获得对应的地址.


CPU查询快表属于硬件操作, 操作系统无法干预. 但由于快表属于高速缓存, 因此其容量较小, 需要通过合适的方法淘汰不常使用的项目, 操作系统可以控制快表的刷新.
